@startuml integration_failure_handling_sequence

title ðŸ”„ Sequence: Integration Failure Handling and Notification

actor ExternalSystem
participant "API Gateway (Golang)" as APIGateway
participant "Service Handler" as ServiceHandler
participant "Integration Manager (Odoo Module)" as IntegrationManager
participant "Notification Service" as NotificationService
participant "Monitoring System" as Monitoring

== Normal Flow: Data Submission Fails ==
ExternalSystem -> APIGateway : POST /api/v1/data\n(header: trace-id, auth token)
APIGateway -> ServiceHandler : Validasi & proses data
ServiceHandler -> IntegrationManager : Cek status integrasi aktif?
alt Integrasi dimatikan
    IntegrationManager --> ServiceHandler : Integrasi nonaktif, reject request
    ServiceHandler --> APIGateway : Response 503 Service Unavailable
    APIGateway -> ExternalSystem : Response gagal
    APIGateway -> Monitoring : Emit metric integrasi nonaktif
else Integrasi aktif, tapi data gagal disimpan
    ServiceHandler -> IntegrationManager : Catat failure log
    IntegrationManager -> NotificationService : Kirim notifikasi ke admin
    ServiceHandler --> APIGateway : Response 500 Internal Server Error
    APIGateway -> ExternalSystem : Response gagal
    APIGateway -> Monitoring : Emit metric error
end

== Notification Handling ==
NotificationService -> Admin : Kirim email / Slack alert

@enduml
